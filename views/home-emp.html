<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>售货员</title>
  <link rel="icon" href="./images/icon-tab.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    /* Ensure the dropdown menu aligns properly and does not get cut off */
    .dropdown-menu {
      right: 0 !important; /* Align dropdown to the right edge */
      left: auto !important; /* Disable left alignment */
      width: 250px; /* Set the desired width */
      height: 240px;
    }
    .navbar {
      overflow: visible; /* Ensure dropdown is not clipped */
    }
    .dropdown-toggle::after {
      border-top-color: #cccccc !important;
    }
    .dropdown-menu {
      border-radius: 8px !important; /* Customize the border-radius */
    }
    .dropdown-menu {
      top: 43.5px !important; /* Lower position */
      right: 0.5px !important; /* Adjust horizontal position */
    }
    a.dropdown-item:focus {
      outline: none;
      box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
      background-color: rgba(180, 180, 180, 0.5); /* Light gray highlight */
      border-radius: 5px; /* Optional: Make the focus area rounded */
      transition: box-shadow 0.2s ease, background-color 0.2s ease;
    }
  </style>
</head>

<body>
  <!-- Navigation bar -->
  <section id="nav-bar">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark py-1" aria-label="Fourth navbar example">
      <div class="container-fluid pe-0">

        <a class="navbar-brand" href="#">精工 PAMS</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExample04">
          <ul class="navbar-nav ms-auto mb-2 mb-md-0 me-3 pe-1" style="padding-left: 8px;">
            <li class="nav-item px-2 mx-1 a">
              <a class="nav-link active" aria-current="page" href="#homepage">首页</a>
            </li>
            <li class="nav-item mx-2 a">
              <a class="nav-link" href="#about">关于</a>
            </li>
            <li class="nav-item mx-1 a">
              <a class="nav-link" href="#projects" aria-disabled="false">查询</a>
            </li>
            <li class="nav-item pe-3 mx-2 a">
              <a class="nav-link" href="#contact">联系</a>
            </li>

            <li class="nav-item my-1 b">
              <div class="flex-shrink-0 dropdown">
                <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                  <img src="./images/la.png" alt="pic" width="32" height="32" class="rounded-circle" style="border: 2px solid rgba(255, 255, 255, 0.2);">
                </a>

                <ul class="dropdown-menu dropdown-menu-start text-small shadow">
                  <li>
                    <a class="d-block link-body-emphasis text-decoration-none mt-4 mb-3" aria-expanded="false" style="text-align: center;">
                      <img src="./images/la.png" alt="pic" width="70" height="70" class="rounded-circle" style="border: 2px solid rgba(0, 0, 0, 0.2);">
                    </a>
                  </li>
                  <li>
                    <p id="user-info" class="mb-3" style="text-align: center;">
                      <span id="user-username">正在加载用户信息..</span><br>
                      <span id="user-role"></span>
                    </p>
                  </li>
                  <li>
                    <hr class="dropdown-divider">
                  </li>
                  <li class="py-1 px-1"><a class="dropdown-item" href="/logout"><i class="bi bi-box-arrow-right pe-1 mb-0"></i> 退出登录</a></li>
                </ul>
              </div>
            </li>

          </ul>
        </div>
      </div>
    </nav>
  </section>

  <!-- Home page -->
  <section id="homepage">
    <div class="position-relative overflow-hidden p-3 p-md-5 mb-md-3 m-md-3 mb-3 mt-md-0 text-center bg-body-tertiary add">
      <div class="p-sm-4 p-lg-5 mx-auto mt-4 mb-3 mt-md-5 custom-align">
        <h4>欢迎使用</h4>
        <h1 class="display-3 fw-bold relative-pos">零件管理系统！</h1>
        <div class="custom-div">
          <p class="fw-normal text-muted mb-3 ps-1 pt-2">精工零件管理系统专注于为企业提供高效、精准的零件管理解决方案。通过我们的智能系统，您可以轻松追踪库存、优化采购流程，提高生产效率，有效提升供应链的整体运作水平。我们秉承“专注细节，成就卓越”的理念，不断创新技术，打造简单易用又功能强大的管理平台，帮助企业降低成本、提升竞争力，让您在快速变化的市场中始终占得先机。</p>
        </div>
      </div>
    </div>
  </section>

  <!-- About Me -->
  <section id="about">
    <div class="position-relative overflow-hidden px-3 px-md-5 m-md-3 mb-3 pt-lg-4 pb-lg-4 add">
      <div class="px-sm-4 px-lg-5 mx-auto mt-4 custom-align custom-last">
        <h2 class="display-6 link-body-emphasis mb-1" id="mod">关于我们</h2>
        <p class="blog-post-meta mt-4 mb-2">公司简介</p>
        <p class="custom-pg">精工零件管理有限公司成立于2024年，总部位于海南。作为一家专注于零件管理的科技公司，我们结合先进的数据库技术和现代化的管理理念，为全球制造业提供全面的解决方案。
          我们的团队由行业资深专家、软件工程师和客户服务人员组成，致力于帮助客户减少运营成本、提升生产效率。</p>
      </div>
    </div>
  </section>

  <!-- Projects -->
  <section id="projects">
    <div class="position-relative overflow-hidden p-4 px-md-5 m-md-3 py-1 py-md-4 text-center bg-body-tertiary">
      <div class="container mt-5 mb-4 test">
        <h1 class="text-center mb-4">仓库信息表</h1>

        <!-- Search Container -->
        <div class="d-flex justify-content-between align-items-center mb-3 pb-1">
          <input type="text" id="search-input" class="form-control me-2" placeholder="按库号或负责人搜索" style="flex: 1;">
          <button class="btn btn-primary me-2" onclick="searchWarehouse()" style="padding-left: 15px; padding-right: 15px;">查询</button>
          <button class="btn btn-secondary" onclick="showAllData()">全部</button>
        </div>

        <!-- Responsive Table -->
        <div class="table-responsive">
          <table id="warehouse-table" class="table table-striped table-bordered" style="table-layout: fixed; width: 100%;">
            <thead class="table-dark">
              <tr>
                <th>仓库编号</th>
                <th>已用库存</th>
                <th>库存总量</th>
                <th>负责人</th>
                <th>电话号码</th>
              </tr>
            </thead>
            <tbody>
              <!-- Data rows will be dynamically inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact">
    <div class="position-relative overflow-hidden px-3 px-md-5 m-md-3 text-center">
      <div class="px-sm-4 px-lg-5 mx-auto mt-2 custom-align mt-4 mb-5">

        <div class="pt-5 text-center">
          <h2>联系我们</h2>
          <p class="lead mx-2 mt-3">欢迎与我们联系，无论是合作提案还是简单问候，我们都乐意为您服务！</p>
          <p>您可以发送邮件至 jg-pams18@gmail.com</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <section>
    <div class="position-relative overflow-hidden px-3 px-md-5 m-md-4 text-center">
      <footer class="d-flex flex-wrap justify-content-between align-items-center py-2 mt-4 border-top">

        <div class="col-md-4 d-flex align-items-left">
          <span class="px-1 mb-3 mb-md-0 text-body-secondary">© 2024 精工零件管理有限公司</span>
        </div>

        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
          <li class="ms-3"><a class="text-body-secondary" href="#"><svg class="bi" width="24" height="24">
                <use xlink:href="#twitter"></use>
              </svg></a></li>
          <li class="ms-3"><a class="text-body-secondary" href="#"><svg class="bi" width="24" height="24">
                <use xlink:href="#instagram"></use>
              </svg></a></li>
          <li class="ms-3"><a class="text-body-secondary" href="#"><svg class="bi" width="24" height="24">
                <use xlink:href="#facebook"></use>
              </svg></a></li>
        </ul>

      </footer>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  <script>
    // Role mapping
    const roleMapping = {
      admin: '管理员',
      employee: '售货员',
      purchasing_agent: '采购员',
      suppliers_agent: '联系人'
    };

    // Fetch user info from the server
    fetch('/user-info')
      .then(response => {
        if (!response.ok) {
          throw new Error('Not logged in');
        }
        return response.json();
      })
      .then(user => {
        // Map the role to the translated name
        const translatedRole = roleMapping[user.role] || user.role;

        // Update the dropdown with the user's info
        document.getElementById('user-username').textContent = `已登录 ${user.username}`;
        document.getElementById('user-role').textContent = `身份为${translatedRole}`;
      })
      .catch(error => {
        console.error('Error fetching user info:', error);
        document.getElementById('user-username').textContent = 'Error fetching username.';
        document.getElementById('user-role').textContent = 'Error fetching role.';
      });

    // READ READ READ
    async function fetchData(endpoint, query = '') {
      const response = await fetch(endpoint + query);
      const data = await response.json();
      populateTable(data);
    }

    function populateTable(data) {
      const tableBody = document.querySelector('#warehouse-table tbody');
      tableBody.innerHTML = '';

      data.forEach(row => {
        const tr = document.createElement('tr');

        Object.values(row).forEach(value => {
          const td = document.createElement('td');
          td.textContent = value;
          tr.appendChild(td);
        });

        tableBody.appendChild(tr);
      });
    }

    function searchWarehouse() {
      const query = document.getElementById('search-input').value;
      fetchData('/search-warehouse?query=' + encodeURIComponent(query));
    }

    function showAllData() {
      fetchData('/warehouse-data');
    }

    // Load all data on page load
    window.onload = () => {
      showAllData();
    };
  </script>

</body>

</html>
